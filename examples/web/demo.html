<!-- Ultralytics üöÄ AGPL-3.0 License - https://ultralytics.com/license -->

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover, interactive-widget=overlays-content"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="format-detection" content="telephone=no, address=no, email=no" />
    <meta
      name="description"
      content="Ultralytics Chat Widget Demo - A lightweight, professional chat client for docs and apps"
    />
    <meta name="color-scheme" content="light dark" />
    <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)" />
    <meta name="theme-color" content="#0a0a0b" media="(prefers-color-scheme: dark)" />
    <title>Ultralytics Chat ‚Äî Demo</title>
    <link
      rel="icon"
      type="image/png"
      href="https://raw.githubusercontent.com/ultralytics/assets/refs/heads/main/logo/favicon-yolo.png"
    />

    <style>
      /* ---------- Design tokens ---------- */
      :root {
        --bg: #ffffff;
        --fg: #0b0b0f;
        --muted: #6b7280;
        --border: #e5e7eb;
        --surface: #f7f7f9;
        --link: #042aff;
        --callout: #eef2ff;
        --code-bg: #0f172a;
        --shadow-1: 0 10px 24px rgba(2, 6, 23, 0.1), 0 2px 8px rgba(2, 6, 23, 0.06);
        --radius: 12px;
        --container: 1200px;
        --safe-top: env(safe-area-inset-top, 0px);
        --safe-bottom: env(safe-area-inset-bottom, 0px);
      }
      @media (prefers-color-scheme: dark) {
        :root {
          --bg: #0a0a0b;
          --fg: #f5f5f5;
          --muted: #a1a1aa;
          --border: #232327;
          --surface: #131318;
          --link: #7aa2ff;
          --callout: #121826;
          --code-bg: #0f172a;
          --shadow-1: 0 10px 28px rgba(0, 0, 0, 0.45), 0 2px 10px rgba(0, 0, 0, 0.25);
        }
      }

      /* ---------- Base ---------- */
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family:
          Inter,
          ui-sans-serif,
          system-ui,
          -apple-system,
          "Segoe UI",
          Roboto,
          "Helvetica Neue",
          Arial;
        background: var(--bg);
        color: var(--fg);
        line-height: 1.55;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
        padding-top: max(0px, var(--safe-top));
      }
      a {
        color: var(--link);
        text-decoration: none;
        word-break: break-word;
      }
      a:hover {
        text-decoration: underline;
      }
      input,
      button {
        font-size: 16px;
      } /* prevent iOS zoom */

      /* Reduce motion for users who prefer it */
      @media (prefers-reduced-motion: reduce) {
        * {
          animation-duration: 0.001s;
          transition-duration: 0.001s;
        }
        .btn:hover,
        .btn.primary:hover {
          transform: none;
        }
      }

      /* ---------- Layout ---------- */
      .topbar {
        position: sticky;
        top: 0;
        z-index: 20;
        backdrop-filter: saturate(120%) blur(8px);
        -webkit-backdrop-filter: saturate(120%) blur(8px);
        background: color-mix(in srgb, var(--bg) 82%, transparent);
        border-bottom: 1px solid var(--border);
      }
      .topbar-inner {
        max-width: var(--container);
        margin: 0 auto;
        padding: calc(8px + var(--safe-top)) 16px 10px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
      }
      .brand {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 800;
        min-width: 0;
      }
      .brand a {
        display: inline-flex;
        cursor: pointer;
      }
      .brand img {
        max-height: 32px;
        max-width: 180px;
      }

      .search-box {
        flex: 1;
        max-width: 600px;
        position: relative;
      }
      .search-input {
        width: 100%;
        padding: 12px 14px 12px 40px;
        border: 1px solid var(--border);
        border-radius: 999px;
        background: var(--surface);
        color: var(--fg);
        font-size: 16px;
        outline: none;
        transition:
          box-shadow 0.12s ease,
          border-color 0.12s ease;
        touch-action: manipulation;
        -webkit-appearance: none;
        appearance: none;
      }
      .search-input:focus-visible {
        border-color: var(--link);
        box-shadow: 0 0 0 3px color-mix(in srgb, var(--link) 15%, transparent);
      }
      .search-icon {
        position: absolute;
        left: 14px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--muted);
        pointer-events: none;
      }
      /* Compact top bar on very small screens */
      @media (max-width: 420px) {
        .topbar-inner {
          gap: 6px;
          padding-left: 12px;
          padding-right: 12px;
        }
        .brand img {
          max-height: 24px;
          max-width: 120px;
        }
        .search-input {
          padding-left: 36px;
        }
      }

      .page {
        max-width: var(--container);
        margin: 24px auto;
        padding: 0 16px 16px;
        display: grid;
        grid-template-columns: 280px 1fr;
        gap: 20px;
      }
      @media (max-width: 960px) {
        .page {
          grid-template-columns: 1fr;
          margin: 12px auto;
        }
      }

      /* ---------- Sidebar ---------- */
      .sidebar {
        position: sticky;
        top: calc(56px + var(--safe-top));
        height: calc(100dvh - 96px - var(--safe-top));
        padding: 14px;
        border: 1px solid var(--border);
        border-radius: var(--radius);
        background: var(--surface);
        box-shadow: var(--shadow-1);
        overflow: auto;
        -webkit-overflow-scrolling: touch;
      }
      @media (max-width: 960px) {
        .sidebar {
          display: none;
        }
      }
      .nav-title {
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--muted);
        margin: 6px 0 10px;
        font-weight: 800;
      }
      .nav {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      .nav li a {
        display: block;
        padding: 10px 10px;
        border-radius: 8px;
        color: var(--fg);
      }
      .nav li a:hover {
        background: color-mix(in srgb, var(--surface) 60%, transparent);
        text-decoration: none;
      }

      /* ---------- Content ---------- */
      .content {
        min-width: 0;
      }
      .content > * + * {
        margin-top: 16px;
      }
      .hero {
        padding: 16px;
        border: 1px solid var(--border);
        border-radius: var(--radius);
        background: var(--surface);
        box-shadow: var(--shadow-1);
      }
      h1 {
        font-size: 28px;
        margin: 0 0 8px;
        letter-spacing: -0.02em;
      }
      @media (max-width: 640px) {
        h1 {
          font-size: 22px;
        }
      }
      .lead {
        color: var(--muted);
        margin: 0 0 12px;
      }

      .toolbar {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 12px;
      }
      .btn {
        appearance: none;
        border: 1px solid var(--border);
        background: var(--bg);
        color: var(--fg);
        border-radius: 10px;
        padding: 10px 14px;
        font-weight: 700;
        cursor: pointer;
        transition:
          transform 0.12s ease,
          background 0.12s ease,
          border-color 0.12s ease;
        touch-action: manipulation;
        min-height: 44px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }
      .btn:hover {
        transform: translateY(-1px);
        background: color-mix(in srgb, var(--surface) 80%, var(--bg));
      }
      .btn:active {
        transform: scale(0.98);
      }
      .btn:focus-visible {
        outline: none;
        box-shadow: 0 0 0 3px color-mix(in srgb, var(--link) 15%, transparent);
      }
      .btn.primary {
        background: #e1ff25;
        color: #111f68;
        border-color: #dce61f;
      }
      .btn.primary:hover {
        transform: translateY(-1px) scale(1.01);
      }
      .btn.primary:active {
        transform: scale(0.98);
      }
      @media (max-width: 520px) {
        .toolbar .btn {
          flex: 1 1 auto;
        }
      }

      .grid {
        display: grid;
        gap: 14px;
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
      @media (max-width: 720px) {
        .grid {
          grid-template-columns: 1fr;
          gap: 12px;
        }
      }
      .card {
        border: 1px solid var(--border);
        border-radius: var(--radius);
        background: var(--surface);
        padding: 14px;
      }
      .card h3 {
        margin: 0 0 8px;
        font-size: 16px;
      }

      .callout {
        border: 1px solid var(--border);
        border-radius: var(--radius);
        background: var(--callout);
        padding: 10px 12px;
        margin: 14px 0;
      }
      .profiling-status {
        margin: 10px 0 0;
        color: var(--muted);
        font-size: 13px;
      }

      pre {
        background: var(--code-bg);
        color: #e5e7eb;
        border-radius: var(--radius);
        padding: 12px;
        overflow: auto;
        margin: 12px 0;
        -webkit-overflow-scrolling: touch;
      }
      code {
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
        font-size: 13px;
        word-break: break-all;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin: 12px 0;
        border: 1px solid var(--border);
        border-radius: var(--radius);
        overflow: hidden;
        background: var(--surface);
        display: block;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
      @media (max-width: 640px) {
        table {
          font-size: 13px;
        }
        th,
        td {
          padding: 8px;
        }
      }
      thead th {
        text-align: left;
        background: color-mix(in srgb, var(--surface) 75%, var(--bg));
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        color: var(--muted);
      }
      th,
      td {
        padding: 12px;
        border-bottom: 1px solid var(--border);
      }
      tr:last-child td {
        border-bottom: none;
      }

      .footer {
        max-width: var(--container);
        margin: 32px auto 16px;
        padding: 0 16px max(20px, var(--safe-bottom));
        color: var(--muted);
        font-size: 13px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
    </style>
  </head>
  <body>
    <!-- Top bar -->
    <header class="topbar">
      <div class="topbar-inner">
        <div class="brand">
          <a href="https://www.ultralytics.com" target="_blank" rel="noopener">
            <img
              src="https://cdn.prod.website-files.com/680a070c3b99253410dd3dcf/68e4eb1e9893320b26cc02c3_Ultralytics%20Logo.png.svg"
              alt="Ultralytics"
              loading="lazy"
              decoding="async"
            />
          </a>
        </div>
        <div class="search-box">
          <svg
            class="search-icon"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            aria-hidden="true"
          >
            <circle cx="11" cy="11" r="8" />
            <path d="m21 21-4.35-4.35" />
          </svg>
          <input
            type="text"
            class="search-input"
            placeholder="Search documentation‚Ä¶"
            onclick="openSearch()"
            readonly
            aria-label="Search documentation"
            role="searchbox"
          />
        </div>
      </div>
    </header>

    <!-- Page -->
    <main class="page">
      <aside class="sidebar" aria-label="Section navigation">
        <div class="nav-title">On this page</div>
        <ul class="nav">
          <li><a href="#intro">Introduction</a></li>
          <li><a href="#install">Install</a></li>
          <li><a href="#benchmarks">Benchmarks</a></li>
          <li><a href="#examples">Examples</a></li>
          <li><a href="#faq">FAQ</a></li>
        </ul>

        <div class="nav-title" style="margin-top: 16px">Guides</div>
        <ul class="nav">
          <li><a href="#inference">YOLO Inference</a></li>
          <li><a href="#training">Training</a></li>
          <li><a href="#export">Export</a></li>
        </ul>
      </aside>

      <section class="content">
        <div class="hero" id="intro">
          <h1>Ultralytics Chat Widget</h1>
          <p class="lead">
            A lightweight, professional chat client for docs and apps. Streams tokens, supports markdown, and uses
            Ultralytics brand UI.
          </p>
          <div class="toolbar">
            <button class="btn" onclick="openChat()" aria-label="Open chat">Open Chat</button>
            <button id="profiling-button" class="btn primary" onclick="runProfiling()" aria-label="Run profiling">
              Run profiling (30 questions)
            </button>
            <span class="btn" style="pointer-events: none; opacity: 0.72">Press ‚åò + K to open</span>
          </div>
        </div>

        <div id="profiling" class="card">
          <h3>Backend Profiling</h3>
          <p>
            This runs 30 YOLO/Ultralytics questions against each backend and reports mean latency, ¬±1œÉ, and min/max.
          </p>
          <div id="profiling-results" class="callout">Click ‚ÄúRun profiling‚Äù to compare endpoints.</div>
          <p id="profiling-status" class="profiling-status" aria-live="polite"></p>
        </div>

        <div class="grid">
          <div class="card">
            <h3>Why this widget</h3>
            <ul>
              <li>Centered modal with blurred/lightened backdrop for focus</li>
              <li>Brand-aligned pill launcher with hover zoom only</li>
              <li>Copy, like/dislike, share, retry actions (dark-mode friendly)</li>
              <li>Animated Send/Stop icon swap ‚Äî arrow up ‚Üî square</li>
              <li>Minimal custom code, easy to embed in any page</li>
            </ul>
          </div>
          <div class="card">
            <h3>Quick start</h3>
            <p>Add the script and instantiate with your config:</p>
            <pre><code>&lt;script src="https://cdn.jsdelivr.net/gh/ultralytics/llm@main/js/chat.js"&gt;&lt;/script&gt;
&lt;script&gt;
  // Option 1: Full configuration (all optional)
  const chat = new UltralyticsChat({
    apiUrl: '/api/chat',
    branding: {
      name: 'My AI Assistant',
      tagline: 'Ask me anything',
      logo: 'logo.png',
      pillText: 'Chat',
    },
    theme: {
      primary: '#042AFF',
      dark: '#111F68',
      yellow: '#E1FF25',
      text: '#0b0b0f',
    },
  });

  // Option 2: Minimal (uses defaults)
  // const chat = new UltralyticsChat({ apiUrl: '/api/chat' });
&lt;/script&gt;</code></pre>
            <p>Then trigger with:</p>
            <pre><code>chat.toggle(true); // open
chat.toggle(false); // close</code></pre>
          </div>
        </div>

        <div id="install" class="card">
          <h3>Install Ultralytics</h3>
          <p>Use pip to get the latest package:</p>
          <pre><code>pip install -U ultralytics</code></pre>
          <div class="callout">
            Tip: Prefer isolated environments (<code>uv</code>,
            <code>venv</code>, or <code>conda</code>) for reproducibility.
          </div>
        </div>

        <div id="benchmarks" class="card">
          <h3>Sample Benchmarks (YOLO11)</h3>
          <table>
            <thead>
              <tr>
                <th>Model</th>
                <th>mAP<sub>50-95</sub></th>
                <th>Params</th>
                <th>FPS (A100)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>YOLO11n</td>
                <td>‚Äî</td>
                <td>‚Äî</td>
                <td>‚Äî</td>
              </tr>
              <tr>
                <td>YOLO11s</td>
                <td>‚Äî</td>
                <td>‚Äî</td>
                <td>‚Äî</td>
              </tr>
              <tr>
                <td>YOLO11m</td>
                <td>‚Äî</td>
                <td>‚Äî</td>
                <td>‚Äî</td>
              </tr>
              <tr>
                <td>YOLO11l</td>
                <td>‚Äî</td>
                <td>‚Äî</td>
                <td>‚Äî</td>
              </tr>
              <tr>
                <td>YOLO11x</td>
                <td>‚Äî</td>
                <td>‚Äî</td>
                <td>‚Äî</td>
              </tr>
            </tbody>
          </table>
          <p class="lead">Numbers depend on dataset and hardware. Replace with your own metrics.</p>
        </div>

        <div id="examples" class="card">
          <h3>Code Examples</h3>
          <p>Inference with Python:</p>
          <pre><code>from ultralytics import YOLO

model = YOLO("yolo11s.pt")
results = model("bus.jpg")
results[0].show()</code></pre>

          <p>Training from CLI:</p>
          <pre><code>yolo train model=yolo11s.pt data=coco.yaml epochs=100 imgsz=640</code></pre>
        </div>

        <div id="inference" class="card">
          <h3>YOLO Inference</h3>
          <p>
            Run single-image, directory, or video streams. Use
            <code>conf</code> and <code>iou</code> to tune precision/recall tradeoffs.
          </p>
        </div>

        <div id="training" class="card">
          <h3>Training</h3>
          <p>Fine-tune on your datasets. Track runs, compare metrics, and export best checkpoints.</p>
        </div>

        <div id="export" class="card">
          <h3>Export</h3>
          <p>Export to formats like ONNX, TensorRT, CoreML:</p>
          <pre><code>yolo export model=best.pt format=onnx opset=13 dynamic</code></pre>
        </div>

        <div id="faq" class="card">
          <h3>FAQ</h3>
          <p>
            <strong>How does the chat integrate with docs?</strong><br />It's a self-contained client that calls your
            API. Pass in RAG context or knowledge base sources on the server side.
          </p>
          <p>
            <strong>Does it support dark mode?</strong><br />Yes. It follows system
            <code>prefers-color-scheme</code> and inherits your CSS variables automatically.
          </p>
        </div>
      </section>
    </main>

    <footer class="footer">
      <span>Need help?</span>
      <a href="#" onclick="openChat();return false;">Ask Ultralytics AI</a>
    </footer>

    <!-- Chat client -->
    <script src="../../js/chat.js"></script>
    <script>
      let chatInstance;

      function openChat() {
        if (chatInstance) chatInstance.toggle(true, "chat");
      }
      function openSearch() {
        if (chatInstance) chatInstance.toggle(true, "search");
      }

      // Avoid iOS overscroll rubber-banding inside modals/containers
      document.addEventListener(
        "touchmove",
        (e) => {
          const el = e.target.closest("pre, table, .sidebar");
          if (el) return; // allow native scroll inside these
          // otherwise, let the page scroll normally
        },
        { passive: true },
      );

      window.addEventListener("DOMContentLoaded", () => {
        chatInstance = new UltralyticsChat({
          branding: {
            name: "Ultralytics AI",
            tagline: "Ask anything about Ultralytics, YOLO, and more",
            logo: "https://cdn.prod.website-files.com/680a070c3b99253410dd3dcf/68e4eb1e9893320b26cc02c3_Ultralytics%20Logo.png.svg",
            logomark:
              "https://storage.googleapis.com/organization-image-assets/ultralytics-botAvatarSrcUrl-1729379860806.svg",
            pillText: "Ask AI",
          },
          theme: {
            primary: "#042AFF",
            dark: "#111F68",
            yellow: "#E1FF25",
            text: "#0b0b0f",
          },
          welcome: {
            title: "Hello üëã",
            message: "I'm an AI assistant trained on Ultralytics documentation - ask me anything!",
            chatExamples: [
              "What's new in SAM 3?",
              "How do I get started with YOLO?",
              "Tell me about Enterprise Licensing",
            ],
            searchExamples: ["YOLO quickstart", "model training parameters", "export formats", "dataset configuration"],
          },
          ui: {
            placeholder: "Ask anything‚Ä¶",
            copyText: "Copy thread",
            downloadText: "Download thread",
            clearText: "New chat",
          },
        });
      });

      const PROFILE_BACKENDS = [
        { name: "Legacy (Cloud Run)", url: "https://chat-885297101091.us-central1.run.app/api/chat" },
        { name: "ul.run", url: "https://ul.run/chat/v1/chat" },
      ];

      const PROFILE_QUESTIONS = [
        "What are the main differences between YOLOv8 and YOLO11 in terms of speed and accuracy?",
        "Show a minimal Python snippet to run inference with a YOLO11n model on a single image.",
        "How do I convert a YOLO dataset into COCO format, and when should I prefer one over the other?",
        "Explain what the 'conf' and 'iou' thresholds do in YOLO inference.",
        "What is the best way to speed up YOLO inference on edge devices like Jetson?",
        "Give me a short explanation of Ultralytics HUB and how it helps with training management.",
        "How do I fine-tune YOLO on a custom dataset with class imbalance?",
        "List common training hyperparameters that affect mAP the most for YOLO.",
        "What is the recommended image size for training YOLO11 models and why?",
        "How do I export YOLO models to TensorRT for deployment?",
        "Explain the difference between NMS and Soft-NMS in the context of YOLO.",
        "Can I train YOLO on video frames directly? What is the suggested pipeline?",
        "Write a YAML snippet for a custom dataset with train/val/test paths.",
        "How do I set up multi-GPU training with Ultralytics in PyTorch?",
        "Describe best practices for labeling datasets for object detection.",
        "What are typical causes of overfitting in YOLO training and how can I mitigate them?",
        "Explain how Ultralytics handles mosaic and mixup augmentations.",
        "Give a concise overview of YOLO tracking modes and when to use them.",
        "How do I run YOLO in a Docker container with GPU support?",
        "What is the difference between yolov8n and yolov8x in terms of size and use cases?",
        "Explain how to evaluate YOLO with mAP@50-95 and why the range matters.",
        "How do I set seed/reproducibility flags in Ultralytics training?",
        "What are good strategies for reducing false positives in YOLO detection?",
        "Can you outline a full training command for YOLO11s with 100 epochs and 640 img size?",
        "Explain what 'autoanchor' does and when it should be disabled.",
        "How do I use Ultralytics to segment objects instead of detect them?",
        "What are the steps to export YOLO to ONNX and validate the outputs?",
        "Write a short guide to deploying YOLO on a FastAPI server with a REST endpoint.",
        "How do I benchmark YOLO inference FPS consistently across devices?",
        "Explain how Ultralytics handles model pruning or quantization options.",
      ];

      let profilingActive = false;

      function formatSeconds(ms) {
        return `${(ms / 1000).toFixed(2)}s`;
      }

      function sleep(ms) {
        return new Promise((resolve) => setTimeout(resolve, ms));
      }

      function computeStats(samples) {
        const count = samples.length;
        if (!count) return null;
        const mean = samples.reduce((a, b) => a + b, 0) / count;
        const variance = samples.reduce((a, b) => a + (b - mean) ** 2, 0) / count;
        const std = Math.sqrt(variance);
        const min = Math.min(...samples);
        const max = Math.max(...samples);
        return { count, mean, std, min, max };
      }

      function setProfilingStatus(text) {
        const statusEl = document.getElementById("profiling-status");
        if (statusEl) statusEl.textContent = text;
      }

      function renderProfilingResults(results) {
        const container = document.getElementById("profiling-results");
        if (!container) return;
        const rows = results
          .map((result) => {
            const stats = computeStats(result.samples);
            if (!stats) {
              return `<tr><td>${result.name}</td><td colspan="5">No successful samples</td></tr>`;
            }
            return `
              <tr>
                <td>${result.name}</td>
                <td>${stats.count}</td>
                <td>${formatSeconds(stats.mean)}</td>
                <td>¬±${formatSeconds(stats.std)}</td>
                <td>${formatSeconds(stats.min)} / ${formatSeconds(stats.max)}</td>
                <td>${result.errors}</td>
              </tr>
            `;
          })
          .join("");

        container.innerHTML = `
          <table>
            <thead>
              <tr>
                <th>Backend</th>
                <th>Samples</th>
                <th>Mean</th>
                <th>1œÉ</th>
                <th>Min / Max</th>
                <th>Errors</th>
              </tr>
            </thead>
            <tbody>
              ${rows}
            </tbody>
          </table>
        `;
      }

      async function timeRequest(url, question) {
        const payload = {
          messages: [{ role: "user", content: question }],
          session_id: null,
          context: {
            url: window.location.href,
            title: document.title,
            description: document.querySelector('meta[name="description"]')?.content || "",
            path: window.location.pathname,
          },
        };
        const start = performance.now();
        const res = await fetch(url, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });
        if (!res.ok) {
          throw new Error(`HTTP ${res.status}`);
        }
        if (res.body?.getReader) {
          const reader = res.body.getReader();
          while (true) {
            const { done } = await reader.read();
            if (done) break;
          }
        } else {
          await res.text();
        }
        return performance.now() - start;
      }

      async function runProfiling() {
        if (profilingActive) return;
        profilingActive = true;
        const btn = document.getElementById("profiling-button");
        if (btn) btn.disabled = true;

        const results = [];
        setProfilingStatus("Profiling started...");

        for (const backend of PROFILE_BACKENDS) {
          const samples = [];
          let errors = 0;
          for (let i = 0; i < PROFILE_QUESTIONS.length; i += 1) {
            setProfilingStatus(`Running ${backend.name}: ${i + 1}/${PROFILE_QUESTIONS.length} questions...`);
            try {
              const duration = await timeRequest(backend.url, PROFILE_QUESTIONS[i]);
              samples.push(duration);
            } catch (err) {
              errors += 1;
              console.warn(`Profiling error for ${backend.name}`, err);
            }
            if (i < PROFILE_QUESTIONS.length - 1) {
              await sleep(3000);
            }
          }
          results.push({ name: backend.name, samples, errors });
        }

        renderProfilingResults(results);
        setProfilingStatus("Profiling complete.");
        if (btn) btn.disabled = false;
        profilingActive = false;
      }
    </script>
  </body>
</html>
